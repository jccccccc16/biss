### 后端管理系统开发日志

#### 1.日志系统

版本id: 857b35d9ef03e7b5ce24f8cec287df645d57c259

完成日志系统，用户的操作会被系统记录到数据库中

#### 2.重新完善项目审核

**增加审核表**，记录该项目由哪一位审核员审核

审核项目展示VO，增加审核员用户名

在项目管理中也显示审核员用户名

1.在getProjectTemp（）获取待审核的方法中，用于前端显示的vo是ProjectReview，现在需要对projectReview增加一个审核员用户名

2.在显示项目详情方法中getReviewProjectDetail，也显示审核员，而无论是项目管理中显示或者项目审核中显示







**修改vo，修改mapper.xml，修改前端**



审核表的状态废除，仍然使用project表中的状态，审核表仅提供审核员，项目，审核理由，审核时间等等



- [x] 修改了日志操作以时间倒序排序



- [x] 修复了时间格式为24小时



- [x] 修复项目审核

状态统一使用project表中的状态，审核表中的状态暂时不用

如果是第一次审核直接插入审核表，修改项目状态

如果是二次审核的话，查询出根据项目id，查询review_project_admin，判断是否是二次审核，修改审核状态，修改审核员，



修复了日志查询可以按照关键词查询，以及查询分页



#### 3.定时任务

分支为：branch_scheduled_check_project

每天凌晨对项目进行判断是否超过众筹期限,

使用定时任务，当超过众筹期限时，将众筹的项目状态修改为众筹失败

spring定时任务模块：

资料参考： https://www.cnblogs.com/zhaoletian/p/10821426.html





- [x] 修改了bug

  当通过审核时插入众筹发起时间，众筹发起时间和众筹天数用于判断项目是否过期



#### 4.会员管理

增加会员管理页面（或者也显示会员众筹的项目数量，支持的项目数量），在审核中也显示会员的相关信息和项目的确定表。



##### 4.1增加会员模块

在会员管理页面显示会员的账号，用户名，邮箱，真名，身份证，（发起的众筹数，支持的项目数，等完成付款操作再做），是否可用。





#### 5.财务管理

##### 5.1订单管理

展示所有状态的订单

在财务管理下的订单管理，**展示订单信息**，显示订单号，显示账号，显示支付宝流水号，所属项目，金额，订单状态，操作是查看明细；提供搜索框。

**查看明细中**，显示订单表中的订单编号，支付宝流水号，订单总额，发票抬头，订单备注，详细地址，用户账号，以及项目名，所支持的回报，订单创建时间，发货时间，确认时间，退款时间，状态，退款财务人员,操作





- 订单状态，1为已支付，2已发货，3订单已确认，4待退款，5已退款

  - 支付后，生成订单（订单增加一个字段，order_status），状态为1

  增加订单表的字段，发货时间，确定时间。

  加一个退款表，记录退款的财务人员，退款订单号，退款时间

  加一个转账表，字段类似

  
  
  
  
  修复bug
  
  1.项目详情中回报的显示
  
  2.项目管理中的项目列表中的审核时间和审核员的显示
  
  
  
  
  
  2022年4月2日13:56:36
  
  
  
  
  
  
  
  
  
  
  
  
  
  完成
  
  
  
  
  
  
  
  

##### 5.2 会员退款

在会员退款中，显示待退款的订单，操作显示“去退款”，去退款显示订单明细

订单明细中显示订单详情页，显示退款按钮，调用支付宝接口



##### 5.3 项目转账

显示众筹成功待转账项目，显示项目名称，众筹金额，发起日期，完成日期

点击待转账，显示项目名称，所众筹金额，发起时间，完成日期，显示需要扣取的手续费，最终获得的金额，项目的收款账号，收款人，收款人信息





订单管理和会员退款的订单详情公用同一个详情页面，但按钮不一样，订单管理不显示按钮，会员退款订单详情像是退款按钮





修复bug

- [ ] 1.如何判断是否以及众筹成功？

  众筹金额达到所需金额即视为成功，但通过什么方法什么是否判断呢？

  当会员支持某项目后，判断该支持金额所获得的金额是否已经达到所需金额，如果达到那么修改状态为众筹成功。需要在会员系统中的修改

```

```





### 前台会员系统开发日志

#### 1.会员个人页面

分支：branch_member_center ，2022年4月2日14:24:06

删除次产总览

只显示我的众筹

里面的我支持的，我发起的

我支持的：根据状态显示，订单状态，操作只留交易详情

显示项目名，订单号，完成度，剩余众筹时间，支持时间，支持金额，运费，回报数量，交易状态，



我发起的，显示所有状态，根据状态显示，操作为，项目详情



我支持的和我发起的都开发完毕，但是还有小的bug，分页导航，



2.首页，去除首页广告，去除按类型排序，只显示项目列表



#### 2.发起项目众筹







修复bug







### 遇到的难题记录

使用自定义注解开发一个标注需要被日志记录的方法时，这是我的第一版本的注解

```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Documented
public @interface BusinessType {
    String value();
}

```

在aop开发中一直获取不到方法的注解，后来才发现需要配置@Retention(RetentionPolicy.RUNTIME)，表名注解在运行时有效







